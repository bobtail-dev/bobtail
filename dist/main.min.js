!function(e,t){if("function"==typeof define&&define.amd)define("bobtail",["exports","bobtail-rx","jquery","underscore","es5-shim","es6-shim"],t);else if("undefined"!=typeof exports)t(exports,require("bobtail-rx"),require("jquery"),require("underscore"),require("es5-shim"),require("es6-shim"));else{var n={exports:{}};t(n.exports,e.rx,e.$,e._,e.es5Shim,e.es6Shim),e.rx=n.exports}}(this,function(e,t,n,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.rxt=void 0,Object.keys(t).forEach(function(n){"default"!==n&&"__esModule"!==n&&Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[n]}})});var u=a(n),l=a(r),f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(t),c=function(){function e(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();u.default.fn.rx=function(e){var t=this,n=this.data("rx-map");if(null==n&&this.data("rx-map",n=Object.create(null)),!(e in n))switch(e){case"focused":var r=f.cell(this.is(":focus"));this.focus(function(){return r.set(!0)}),this.blur(function(){return r.set(!1)}),n[e]=r;break;case"val":var a=f.cell(this.val());this.change(function(){return a.set(t.val())}),this.on("input",function(){return a.set(t.val())}),n[e]=a;break;case"checked":var o=f.cell(this.is(":checked"));this.change(function(){return o.set(t.is(":checked"))}),n[e]=o;break;default:throw new Error("Unknown reactive property type")}return n[e]};var s=function(e){return l.default.isFunction(e)?f.bind(e):e},d=function(e){return f.flatten(e,m)},m=function e(t){return l.default.isFunction(t)?e(t()):f.flattenHelper(t,e)},p=function(e){return(e instanceof f.ObsCell||e instanceof f.ObsArray||l.default.isArray(e)||l.default.isFunction(e))&&(e=d(e)),e},h={};h.enabled=!1,h.onElementChildrenChanged=new f.Ev,h.onElementAttrsChanged=new f.Ev;var y=function e(t){i(this,e),this.html=t},v=["blur","change","click","dblclick","error","focus","focusin","focusout","hover","keydown","keypress","keyup","load","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","ready","resize","scroll","select","submit","toggle","unload"],g=["click"],b=function(e){return(0,l.default)(e).chain().flatten().compact().value().join(" ").replace(/\s+/," ").trim()},w={init:function(e,t){return t.call(e)},style:function(e,t){var n=(t=s(t))instanceof f.ObsCell;return f.autoSub(f.cast(t).onSet,function(t){var r=c(t,2),a=(r[0],r[1]);if(null==a||l.default.isString(a)?_(e,"style",a):e.removeAttr("style").css(a),n&&h.enabled)return h.onElementAttrsChanged.pub({$element:e,attr:"style"})})},class:function(e,t){return q(e,"class",t,function(e){return l.default.isString(e)?e:b(e)})}},k=!0,x=!1,A=void 0;try{for(var S,C=v[Symbol.iterator]();!(k=(S=C.next()).done);k=!0)!function(e){w[e]=function(t,n){return t instanceof SVGElement&&Array.from(g).includes(e)?t.addEventListener(e,n):t[e](function(e){return n.call(t,e)})}}(S.value)}catch(e){x=!0,A=e}finally{try{!k&&C.return&&C.return()}finally{if(x)throw A}}var E=u.default.trim,j=["async","autofocus","checked","location","multiple","readOnly","selected","selectedIndex","tagName","nodeName","nodeType","ownerDocument","defaultChecked","defaultSelected"],O=l.default.object(j.map(function(e){return[e,null]})),_=function(e,t,n){return e instanceof SVGElement?e.setAttribute(t,n):"value"===t?e.val(n):t in O?e.prop(t,n):e.attr(t,n)},q=function(e,t,n,r){return null==r&&(r=l.default.identity),(n=s(n))instanceof f.ObsCell?f.autoSub(n.onSet,function(n){var a=c(n,2),o=(a[0],a[1]);if(_(e,t,r(o)),h.enabled)return h.onElementAttrsChanged.pub({$element:e,attr:t})}):_(e,t,r(n))},N=function(e){return l.default.isString(e)||l.default.isNumber(e)||l.default.isArray(e)||l.default.isBoolean(e)||l.default.isFunction(e)||e instanceof Element||e instanceof SVGElement||e instanceof y||e instanceof u.default||e instanceof f.ObsCell||e instanceof f.ObsArray||e instanceof f.ObsSet},F=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t=t.filter(function(e){return null!=e});var r=l.default.first(t),a=t.slice(1);return null!=r||a.length?N(r)?t.length>1?[{},t]:[{},r]:0===a.length?[r,null]:1===a.length?[r,l.default.first(a)]:[r,a]:[{},null]},G=function(e){var t=[],n=!0,r=!1,a=void 0;try{for(var o,i=Array.from(e)[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var f=o.value;if(null!=f)if(l.default.isString(f)||l.default.isNumber(f))t.push(document.createTextNode(f));else if(f instanceof Element||f instanceof SVGElement)t.push(f);else if(f instanceof y){var c=(0,u.default)(f.html);if(1!==c.length)throw new Error("RawHtml must wrap a single element");t.push(c[0])}else{if(!(f instanceof u.default))throw new Error("Unknown element type in array: "+f.constructor.name+" (must be string, number, function, \nElement, RawHtml, or jQuery objects)");if(1!==f.length)throw new Error("jQuery object must wrap a single element");t.push(f[0])}else t.push(void 0)}}catch(e){r=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}return t},H=function e(t,n){if(t.html&&t.html(""),null!=n){if(l.default.isArray(n)){var r=G(n);return t.append(r),r}if(l.default.isString(n)||l.default.isNumber(n)||l.default.isBoolean(n)||n instanceof Element||n instanceof SVGElement||n instanceof y||n instanceof u.default)return e(t,[n]);throw new Error("Unknown type for element contents: "+n.constructor.name+" \n(accepted types: string, number, Element, RawHtml, jQuery object of single element, \nor array of the aforementioned)")}},P=function(e){return function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return V.apply(void 0,[e].concat(n))}},V=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=Array.from(F.apply(void 0,n)),o=c(a,2),i=o[0],d=o[1];d=p(d);var m=(0,u.default)("<"+e+"/>");i=l.default.mapObject(i,function(e,t){return t in w?e:s(e)});var y=l.default.omit(i,l.default.keys(w));for(var v in y){var g=y[v];q(m,v,g)}null!=d&&(d instanceof f.ObsArray?f.autoSub(d.indexed().onChangeCells,function(e){var t=c(e,3),n=t[0],r=t[1],a=t[2];m.contents().slice(n,n+r.length).remove();var o=G(a.map(function(e){var t=c(e,2),n=t[0];t[1];return f.snap(function(){return n.get()})}));return n===m.contents().length?m.append(o):m.contents().eq(n).before(o),h.enabled&&(r.length||o.length)&&h.onElementChildrenChanged.pub({$element:m,type:"childrenUpdated",added:o,removed:G(r.map(function(e){return f.snap(function(){return e.get()})}))}),function(){var e=[],t=!0,n=!1,r=void 0;try{for(var i,u=Array.from(a)[Symbol.iterator]();!(t=(i=u.next()).done);t=!0){var l=c(i.value,2),s=l[0],d=l[1];e.push(function(e,t){return f.autoSub(e.onSet,f.skipFirst(function(e){var n=c(e,2),r=(n[0],n[1]),a=f.snap(function(){return t.get()});if(o=G([r]),m.contents().eq(a).replaceWith(o),h.enabled)return h.onElementChildrenChanged.pub({$element:m,type:"childrenUpdated",updated:o})}))}(s,d))}}catch(e){n=!0,r=e}finally{try{!t&&u.return&&u.return()}finally{if(n)throw r}}return e}()}):H(m,d));for(var b in i)i.hasOwnProperty(b)&&w.hasOwnProperty(b)&&w[b](m,i[b],i,d);return m},$=["html","head","title","base","link","meta","style","script","noscript","body","body","section","nav","article","aside","h1","h2","h3","h4","h5","h6","h1","h6","header","footer","address","main","main","p","hr","pre","blockquote","ol","ul","li","dl","dt","dd","dd","figure","figcaption","div","a","em","strong","small","s","cite","q","dfn","abbr","data","time","code","var","samp","kbd","sub","sup","i","b","u","mark","ruby","rt","rp","bdi","bdo","span","br","wbr","ins","del","img","iframe","embed","object","param","object","video","audio","source","video","audio","track","video","audio","canvas","map","area","area","map","svg","math","table","caption","colgroup","col","tbody","thead","tfoot","tr","td","th","form","fieldset","legend","fieldset","label","input","button","select","datalist","optgroup","option","select","datalist","textarea","keygen","output","progress","meter","details","summary","details","menuitem","menu"],M=["a","altglyph","altglyphdef","altglyphitem","animate","animatecolor","animatemotion","animatetransform","circle","clippath","color-profile","cursor","defs","desc","ellipse","feblend","fecolormatrix","fecomponenttransfer","fecomposite","feconvolvematrix","fediffuselighting","fedisplacementmap","fedistantlight","feflood","fefunca","fefuncb","fefuncg","fefuncr","fegaussianblur","feimage","femerge","femergenode","femorphology","feoffset","fepointlight","fespecularlighting","fespotlight","fetile","feturbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialgradient","rect","script","set","stop","style","svg","switch","symbol","text","textpath","title","tref","tspan","use","view","vkern"],T=function e(t,n){for(;t.firstChild;)t.removeChild(t.firstChild);if(l.default.isArray(n)){var r=G(n);return Array.from(r).map(function(e){return t.appendChild(e)})}if(l.default.isString(n)||n instanceof SVGElement)return e(t,[n]);throw console.error("updateSVGContents",t,n),"Must wrap contents "+n+" as array or string"},U=function(e){return function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=Array.from(F.apply(void 0,n)),o=c(a,2),i=o[0],u=o[1],s=document.createElementNS("http://www.w3.org/2000/svg",e),d=l.default.omit(i,l.default.keys(w));for(var m in d){var p=d[m];q(s,m,p)}l.default.isFunction(u)&&(u=f.bind(u)),null!=u&&(u instanceof f.ObsArray?u.onChange.sub(function(){for(var e=Array.from(arguments.length<=0?void 0:arguments[0]),t=c(e,3),n=t[0],r=t[1],a=t[2],o=0,i=r.length,u=0<=i;u?o<i:o>i;u?o++:o--)s.removeChild(s.childNodes[n]);var l=G(a);return n===s.childNodes.length?l.map(function(e){return s.appendChild(e)}):l.map(function(e){return s.childNodes[n].insertBefore(e)})}):u instanceof f.ObsCell?u.onSet.sub(function(e){var t=c(e,2),n=(t[0],t[1]);return T(s,n)}):T(s,u));for(var h in i)h in w&&w[h](s,i[h],i,u);return s}},R=($=l.default.object($.map(function(e){return[e,P(e)]}))).input,z=function(e,t){return R(l.default.extend({type:e},t))};R.color=function(e){return z("color",e)},R.date=function(e){return z("date",e)},R.datetime=function(e){return z("datetime",e)},R.datetimeLocal=function(e){return z("datetime-local",e)},R.email=function(e){return z("email",e)},R.file=function(e){return z("file",e)},R.hidden=function(e){return z("hidden",e)},R.image=function(e){return z("image",e)},R.month=function(e){return z("month",e)},R.number=function(e){return z("number",e)},R.password=function(e){return z("password",e)},R.range=function(e){return z("range",e)},R.reset=function(e){return z("reset",e)},R.search=function(e){return z("search",e)},R.submit=function(e){return z("submit",e)},R.tel=function(e){return z("tel",e)},R.text=function(e){return z("text",e)},R.time=function(e){return z("time",e)},R.url=function(e){return z("url",e)},R.week=function(e){return z("week",e)};var B=function(e){return e._oldProp=e.prop,e.prop=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=e._oldProp.apply(e,o(Array.from(n||[])));return n.length>1&&"checked"===n[0]&&e.rx("checked").set(e.prop("checked")),a},e};R.checkbox=function(e){return B(R(l.default.extend({type:"checkbox"},e)))},R.radio=function(e){return B(R(l.default.extend({type:"radio"},e)))},M=l.default.object(M.map(function(e){return[e,U(e)]}));var L=function(e){return new y(e)};w.class=function(e,t){return q(e,"class",t,function(e){return l.default.isString(e)?e:b(e)})},w.className=w.class;e.rxt={events:h,RawHtml:y,specialAttrs:w,mktag:P,svg_mktag:U,tags:$,svg_tags:M,rawHtml:L,specialChar:function(e,t){return null==t&&(t="span"),L("<"+t+">&"+e+";</"+t+">")},unicodeChar:function(e,t){return null==t&&(t="span"),L("<"+t+">\\u"+e+";</"+t+">")},trim:E,dasherize:function(e){return E(e).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},smushClasses:b,normalizeTagArgs:F,flattenWeb:d,rxtFlattenHelper:m,createElement:function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(l.default.isString(e))return V.apply(void 0,[e,t].concat(r));if(l.default.isObject(e)&&e.prototype&&l.default.isFunction(e.prototype.render))return(new(Function.prototype.bind.apply(e,[null].concat([t],r)))).render();if(l.default.isFunction(e))return e.apply(void 0,[t].concat(r));throw Error("Cannot create element "+e+"!")}}});