(function(){var n=[].slice,t=function(n,t){function r(){this.constructor=n}for(var u in t)e.call(t,u)&&(n[u]=t[u]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n},e={}.hasOwnProperty,r=[].indexOf||function(n){for(var t=0,e=this.length;t<e;t++)if(t in this&&this[t]===n)return t;return-1};!function(n,t){var e,r,u,i,o;if(u=["underscore"],(i="undefined"!=typeof window)&&u.push("jquery"),null!=("undefined"!=typeof define&&null!==define?define.amd:void 0))return define(u,t);if(null!=("undefined"!=typeof module&&null!==module?module.exports:void 0))return e=i?require("jquery"):void 0,r=require("underscore"),require("es5-shim"),require("es6-shim"),o=t(r,e),module.exports=o;if(null!=n._&&null!=n.$)return n.rx=t(n._,n.$);throw"Dependencies are not met for reactive: _ and $ not found"}(this,function(e,u){var i,o,s,a,c,l,f,h,p,d,g,m,y,b,v,_,w,S,C,A,k,E,M,x,O,j,D,z,N,R,B,I,W,T,U,q,P,H,$,G,V,F,L,Q,J,Z,K,X,Y,nn,tn,en,rn,un,on,sn,an,cn,ln,fn,hn,pn,dn;if(Y={},P=0,q=function(){return P+=1},hn=function(t,e){return new Set(n.call(t).concat(n.call(e)))},B=function(n,t){return new Set(Array.from(n).filter(function(n){return t.has(n)}))},j=function(n,t){return new Set(Array.from(n).filter(function(n){return!t.has(n)}))},L=function(n,t){var e;if(!(t in n))throw new Error("object has no key "+t);return e=n[t],delete n[t],e},T=function(n,t){var e;return e=n.get(t),n.delete(t),e},$=function(n,t,e){var r,u,i,o;for(r=u=0,i=n.length;u<i;r=++u)if(o=n[r],e(o)&&(t-=1)<0)return[o,r];return[null,-1]},function(n,t){return $(n,0,t)},U=function(n){var t,r,u,i,o,s;if(null==n&&(n=[]),i=null!=Object.create?Object.create(null):{},e.isArray(n))for(t=0,u=n.length;t<u;t++)r=(o=n[t])[0],s=o[1],i[r]=s;else for(r in n)s=n[r],i[r]=s;return i},un=function(n){var t,e,r;for(r=0,t=0,e=n.length;t<e;t++)r+=n[t];return r},a=Y.DepMgr=function(){function n(){this.buffering=0,this.buffer=[],this.events=new Set}return n.prototype.transaction=function(n){var t,r,u,i;this.buffering+=1;try{i=n()}finally{if(this.buffering-=1,0===this.buffering){u=new Set(e.flatten(Array.from(this.events).map(function(n){var t;return t=n.downstreamCells,Array.from(t)}))),(t=Y.allDownstream.apply(Y,u)).forEach(function(n){return n._shield=!0});try{r=this.buffer,this.buffer=[],this.events.clear(),r.map(function(n){var t,e;return e=n[0],t=n[1],e.pub(t)}),t.forEach(function(n){return n.refresh()})}finally{t.forEach(function(n){return n._shield=!1})}}}return i},n}(),Y._depMgr=O=new a,l=Y.Ev=function(){function n(n,t){this.init=n,this.observable=t,this.subs=U(),this.downstreamCells=new Set}return n.prototype.sub=function(n){var t;return t=q(),null!=this.init&&n(this.init()),this.subs[t]=n,t},n.prototype.pub=function(n){var t,e,r,u;if(O.buffering)return O.buffer.push([this,n]),O.events.add(this);e=this.subs,r=[];for(u in e)t=e[u],r.push(t(n));return r},n.prototype.unsub=function(n){return L(this.subs,n)},n.prototype.scoped=function(n,t){var e;e=this.sub(n);try{return t()}finally{this.unsub(e)}},n}(),Y.skipFirst=function(t){var e;return e=!0,function(){var r;return r=1<=arguments.length?n.call(arguments,0):[],e?e=!1:t.apply(null,r)}},Y.upstream=function(n){var t,e;return e=Array.from(n.upstreamEvents),t=e.map(function(n){return n.observable}),Array.from(new Set(t))},E=Y._allDownstreamHelper=function(){var t,r;return(t=1<=arguments.length?n.call(arguments,0):[]).length?(r=Array.from(new Set(e.flatten(t.map(function(n){return Array.from(n.onSet.downstreamCells)})))),e.flatten([r,E.apply(null,r)])):[]},Y.allDownstream=function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],Array.from(new Set(n.call(t).concat(n.call(E.apply(null,t))).reverse())).reverse()},v=Y.Recorder=function(){function t(){this.stack=[],this.isMutating=!1,this.isIgnoring=!1,this.hidingMutationWarnings=!1,this.onMutationWarning=new l}return t.prototype.record=function(n,t){var r,u;this.stack.length>0&&!this.isMutating&&e(this.stack).last().addNestedBind(n),this.stack.push(n),u=this.isMutating,this.isMutating=!1,r=this.isIgnoring,this.isIgnoring=!1;try{return t()}finally{this.isIgnoring=r,this.isMutating=u,this.stack.pop()}},t.prototype.sub=function(t,r){var u;if(null==r&&(r=function(){return!0}),this.stack.length>0&&!this.isIgnoring)return(u=e(this.stack).last()).upstreamEvents.add(t),t.downstreamCells.add(u),Y.autoSub(t,function(){var t;if(t=1<=arguments.length?n.call(arguments,0):[],r.apply(null,t))return u.refresh()})},t.prototype.addCleanup=function(n){if(this.stack.length>0)return e(this.stack).last().addCleanup(n)},t.prototype.hideMutationWarnings=function(n){var t;t=this.hidingMutationWarnings,this.hidingMutationWarnings=!0;try{return n()}finally{this.hidingMutationWarnings=t}},t.prototype.fireMutationWarning=function(){return console.warn("Mutation to observable detected during a bind context"),this.onMutationWarning.pub(null)},t.prototype.mutating=function(n){var t;this.stack.length>0&&!this.hidingMutationWarnings&&this.fireMutationWarning(),t=this.isMutating,this.isMutating=!0;try{return n()}finally{this.isMutating=t}},t.prototype.ignoring=function(n){var t;t=this.isIgnoring,this.isIgnoring=!0;try{return n()}finally{this.isIgnoring=t}},t}(),Y.types={cell:"cell",array:"array",map:"map",set:"set"},Y._recorder=X=new v,Y.hideMutationWarnings=function(n){return X.hideMutationWarnings(n)},Y.asyncBind=M=function(n,t){var e;return(e=new o(t,n)).refresh(),e},Y.promiseBind=function(n,t){return M(n,function(){return this.record(t).done(function(n){return function(t){return n.done(t)}}(this))})},Y.bind=x=function(n){return M(null,function(){return this.done(this.record(n))})},Y.lagBind=function(n,t,e){var r;return r=null,M(t,function(){return null!=r&&clearTimeout(r),r=setTimeout(function(n){return function(){return n.done(n.record(e))}}(this),n)})},Y.postLagBind=function(n,t){var e;return e=null,M(n,function(){var n,r,u;return r=this.record(t),u=r.val,n=r.ms,null!=e&&clearTimeout(e),e=setTimeout(function(n){return function(){return n.done(u)}}(this),n)})},Y.snap=function(n){return X.ignoring(n)},Y.onDispose=function(n){return X.addCleanup(n)},Y.autoSub=function(n,t){var e;return e=n.sub(t),Y.onDispose(function(){return n.unsub(e)}),e},Y.subOnce=function(t,r){var u;return u=Y.autoSub(t,Y.skipFirst(function(){var i;return i=1<=arguments.length?n.call(arguments,0):[],e.defer(function(){return r.apply(null,i)}),t.unsub(u)}))},d=Y.ObsBase=function(){function n(){this.events=[]}return n.prototype.to={cell:function(){return Y.cell.from(n)},array:function(){return Y.array.from(n)},map:function(){return Y.map.from(n)},set:function(){return Y.set.from(n)}},n.prototype.flatten=function(){return Y.flatten(this)},n.prototype.subAll=function(n){return null==n&&(n=function(){return!0}),this.events.forEach(function(t){return X.sub(t,n)})},n.prototype.raw=function(){return this._base},n.prototype._mkEv=function(n){var t;return t=new l(n,this),this.events.push(t),t},n}(),g=Y.ObsCell=function(n){function e(n){var t,r;this._base=n,e.__super__.constructor.call(this),this._base=null!=(r=this._base)?r:null,this.onSet=this._mkEv(function(n){return function(){return[null,n._base]}}(this)),this._shield=!1,t=function(n){return function(){return n.onSet.downstreamCells}}(this),this.refreshAll=function(n){return function(){var e;if(n.onSet.downstreamCells.size&&!n._shield){n._shield=!0,(e=Y.allDownstream.apply(Y,Array.from(t()))).forEach(function(n){return n._shield=!0});try{return e.forEach(function(n){return n.refresh()})}finally{e.forEach(function(n){return n._shield=!1}),n._shield=!1}}}}(this),this.refreshSub=Y.autoSub(this.onSet,this.refreshAll)}return t(e,d),e.prototype.all=function(){return this.subAll(function(n){return function(){return!n._shield}}(this)),this._base},e.prototype.get=function(){return this.all()},e.prototype.readonly=function(){return new o(function(n){return function(){return n.all()}}(this))},e}(),w=Y.SrcCell=function(n){function e(){return e.__super__.constructor.apply(this,arguments)}return t(e,g),e.prototype.set=function(n){return X.mutating(function(t){return function(){var e;if(t._base!==n)return e=t._base,t._base=n,t.onSet.pub([e,n]),e}}(this))},e}(),o=Y.DepCell=function(n){function e(n,t){this.body=n,e.__super__.constructor.call(this,null!=t?t:null),this.refreshing=!1,this.nestedBinds=[],this.cleanups=[],this.upstreamEvents=new Set}return t(e,g),e.prototype.refresh=function(){var n,t,e,r,u,i;if(!this.refreshing)return e=this._base,r=function(n){return function(t){return n._base=t,n.onSet.pub([e,n._base])}}(this),u=!1,i=null,t=!1,n={record:function(e){return function(o){var s;if(!e.refreshing){if(e.disconnect(),u)throw new Error("this refresh has already recorded its dependencies");e.refreshing=!0,u=!0;try{s=X.record(e,function(){return o.call(n)})}finally{e.refreshing=!1}return t&&r(i),s}}}(this),done:function(n){return function(u){if(e!==u)return n.refreshing?(t=!0,i=u):r(u)}}(this)},this.body.call(n)},e.prototype.disconnect=function(){var n,t,e,r,u,i;for(n=0,e=(u=this.cleanups).length;n<e;n++)(0,u[n])();for(t=0,r=(i=this.nestedBinds).length;t<r;t++)i[t].disconnect();return this.nestedBinds=[],this.cleanups=[],this.upstreamEvents.forEach(function(n){return function(t){return t.downstreamCells.delete(n)}}(this)),this.upstreamEvents.clear()},e.prototype.addNestedBind=function(n){return this.nestedBinds.push(n)},e.prototype.addCleanup=function(n){return this.cleanups.push(n)},e}(),p=Y.ObsArray=function(e){function r(n,t){this._cells=null!=n?n:[],this.diff=null!=t?t:Y.basicDiff(),r.__super__.constructor.call(this),this.onChange=this._mkEv(function(n){return function(){return[0,[],n._cells.map(function(n){return n.raw()})]}}(this)),this.onChangeCells=this._mkEv(function(n){return function(){return[0,[],n._cells]}}(this)),this._indexed=null}return t(r,d),r.prototype.all=function(){return X.sub(this.onChange),this._cells.map(function(n){return n.get()})},r.prototype.raw=function(){return this._cells.map(function(n){return n.raw()})},r.prototype.readonly=function(){return new i(function(n){return function(){return n.all()}}(this))},r.prototype.rawCells=function(){return this._cells},r.prototype.at=function(n){var t;return X.sub(this.onChange,function(t){var e,r,u;return r=t[0],u=t[1],e=t[2],r<=n&&u.length!==e.length||u.length===e.length&&n<=r+u.length}),null!=(t=this._cells[n])?t.get():void 0},r.prototype.length=function(){return X.sub(this.onChangeCells,function(n){var t,e;return n[0],e=n[1],t=n[2],e.length!==t.length}),this._cells.length},r.prototype.size=function(){return this.length()},r.prototype.map=function(n){var t;return t=new h,Y.autoSub(this.onChangeCells,function(e){var r,u,i,o,s,a,c,l;for(i=e[0],l=e[1],r=e[2],o=0,s=(c=t._cells.slice(i,i+l.length)).length;o<s;o++)(u=c[o]).disconnect();return a=r.map(function(t){return u=x(function(){return n(t.get())})}),t.realSpliceCells(i,l.length,a)}),t},r.prototype.transform=function(n,t){return new i(function(t){return function(){return n(t.all())}}(this),t)},r.prototype.filter=function(n){return this.transform(function(t){return t.filter(n)})},r.prototype.slice=function(n,t){return this.transform(function(e){return e.slice(n,t)})},r.prototype.reduce=function(n,t){return this.all().reduce(n,null!=t?t:this.at(0))},r.prototype.reduceRight=function(n,t){return this.all().reduceRight(n,null!=t?t:this.at(0))},r.prototype.every=function(n){return this.all().every(n)},r.prototype.some=function(n){return this.all().some(n)},r.prototype.indexOf=function(n,t){return null==t&&(t=0),this.all().indexOf(n,t)},r.prototype.lastIndexOf=function(n,t){return null==t&&(t=this.length()-1),this.all().lastIndexOf(n,t)},r.prototype.join=function(n){return null==n&&(n=","),this.all().join(n)},r.prototype.first=function(){return this.at(0)},r.prototype.last=function(){return this.at(this.length()-1)},r.prototype.indexed=function(){return null==this._indexed&&(this._indexed=new f,Y.autoSub(this.onChangeCells,function(n){return function(t){var e,r,u;return r=t[0],u=t[1],e=t[2],n._indexed.realSpliceCells(r,u.length,e)}}(this))),this._indexed},r.prototype.concat=function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],Y.concat.apply(Y,[this].concat(n.call(t)))},r.prototype.realSpliceCells=function(n,t,e){var r,u,i;return u=this._cells.splice.apply(this._cells,[n,t].concat(e)),i=Y.snap(function(){var n,t,e,r;for(e=[],n=0,t=u.length;n<t;n++)r=u[n],e.push(r.get());return e}),r=Y.snap(function(){var n,t,r,u;for(r=[],n=0,t=e.length;n<t;n++)u=e[n],r.push(u.get());return r}),Y.transaction(function(t){return function(){return t.onChangeCells.pub([n,u,e]),t.onChange.pub([n,i,r])}}(this))},r.prototype.realSplice=function(n,t,e){return this.realSpliceCells(n,t,e.map(Y.cell))},r.prototype._update=function(n,t){var e,r,u,i,o,s,a,c,l,f,h;for(null==t&&(t=this.diff),u=[0,(a=Y.snap(function(n){return function(){var t,e,r,u,i;for(u=[],t=0,e=(r=n._cells).length;t<e;t++)i=r[t],u.push(i.get());return u}}(this))).length,n],null,l=[],o=0,s=(h=null!=t&&null!=(c=F(a.length,n,t(a,n)))?c:[u]).length;o<s;o++)i=(f=h[o])[0],r=f[1],e=f[2],l.push(this.realSplice(i,r,e));return l},r}(),_=Y.SrcArray=function(r){function u(){return u.__super__.constructor.apply(this,arguments)}return t(u,p),u.prototype.spliceArray=function(n,t,e){return X.mutating(function(r){return function(){return r.realSplice(n,t,e)}}(this))},u.prototype.splice=function(){var t,e,r;return r=arguments[0],e=arguments[1],t=3<=arguments.length?n.call(arguments,2):[],this.spliceArray(r,e,t)},u.prototype.insert=function(n,t){return this.splice(t,0,n)},u.prototype.remove=function(n){var t;if((t=e(this.raw()).indexOf(n))>=0)return this.removeAt(t)},u.prototype.removeAll=function(n){return Y.transaction(function(t){return function(){var r,u;for(r=e(Y.snap(function(){return t.all()})).indexOf(n),u=[];r>=0;)t.removeAt(r),u.push(r=e(Y.snap(function(){return t.all()})).indexOf(n));return u}}(this))},u.prototype.removeAt=function(n){var t;return t=Y.snap(function(t){return function(){return t.at(n)}}(this)),this.splice(n,1),t},u.prototype.push=function(n){return this.splice(Y.snap(function(n){return function(){return n.length()}}(this)),0,n)},u.prototype.pop=function(){return this.removeAt(Y.snap(function(n){return function(){return n.length()-1}}(this)))},u.prototype.put=function(n,t){return this.splice(n,1,t)},u.prototype.replace=function(n){return this.spliceArray(0,Y.snap(function(n){return function(){return n.length()}}(this)),n)},u.prototype.unshift=function(n){return this.insert(n,0)},u.prototype.shift=function(){return this.removeAt(0)},u.prototype.update=function(n){return X.mutating(function(t){return function(){return t._update(n)}}(this))},u.prototype.move=function(n,t){return Y.transaction(function(e){return function(){var r,u;if(n!==t){if(r=Y.snap(function(){return e.length()}),n<0||n>r-1)throw"Source "+n+" is outside of bounds of array of length "+r;if(t<0||t>r)throw"Destination "+t+" is outside of bounds of array of length "+r;u=Y.snap(function(){return e.all()[n]}),n>t?(e.removeAt(n),e.insert(u,t)):(e.insert(u,t),e.removeAt(n))}}}(this))},u.prototype.swap=function(n,t){return Y.transaction(function(e){return function(){var r,u,i;if(u=Y.snap(function(){return e.length()}),n<0||n>u-1)throw"i1 "+n+" is outside of bounds of array of length "+u;if(t<0||t>u-1)throw"i2 "+t+" is outside of bounds of array of length "+u;return r=Math.min(n,t),i=Math.max(n,t),e.move(r,i),e.move(i,r)}}(this))},u.prototype.reverse=function(){return this.update(Y.snap(function(n){return function(){return n.all().reverse()}}(this))),Y.snap(function(n){return function(){return n.all()}}(this))},u}(),h=Y.MappedDepArray=function(n){function e(){e.__super__.constructor.call(this)}return t(e,p),e}(),f=Y.IndexedDepArray=function(r){function u(n,t){var r,i;null==n&&(n=[]),u.__super__.constructor.call(this,n,t),this.is=function(){var n,t,e,u;for(e=this._cells,u=[],r=n=0,t=e.length;n<t;r=++n)i=e[r],u.push(Y.cell(r));return u}.call(this),this.onChangeCells=this._mkEv(function(n){return function(){return[0,[],e.zip(n._cells,n.is)]}}(this)),this.onChange=this._mkEv(function(n){return function(){return[0,[],e.zip(n.is,Y.snap(function(){return n.all()}))]}}(this))}return t(u,p),u.prototype.map=function(n){var t;return t=new h,Y.autoSub(this.onChangeCells,function(e){var r,u,i,o,s,a,c,l,f,h;for(o=e[0],h=e[1],r=e[2],a=0,c=(f=t._cells.slice(o,o+h.length)).length;a<c;a++)(u=f[a]).disconnect();return l=function(){var t,e,o,a;for(a=[],t=0,e=r.length;t<e;t++)o=r[t],s=o[0],i=o[1],a.push(u=x(function(){return n(s.get(),i)}));return a}(),t.realSpliceCells(o,h.length,l)}),t},u.prototype.realSpliceCells=function(t,r,u){var i,o,s,a,c,l,f,h,p,d;for(p=this._cells.splice.apply(this._cells,[t,r].concat(u)),d=Y.snap(function(){var n,t,e,r;for(e=[],n=0,t=p.length;n<t;n++)r=p[n],e.push(r.get());return e}),l=s=0,a=(f=this.is.slice(t+r)).length;s<a;l=++s)(o=f[l]).set(t+u.length+l);return c=function(){var n,e,r;for(r=[],o=n=0,e=u.length;0<=e?n<e:n>e;o=0<=e?++n:--n)r.push(Y.cell(t+o));return r}(),(h=this.is).splice.apply(h,[t,r].concat(n.call(c))),i=Y.snap(function(){var n,t,e,r;for(e=[],n=0,t=u.length;n<t;n++)r=u[n],e.push(r.get());return e}),Y.transaction(function(n){return function(){return n.onChangeCells.pub([t,p,e.zip(u,c)]),n.onChange.pub([t,d,e.zip(i,c)])}}(this))},u}(),Y.IndexedMappedDepArray=function(n){function e(){return e.__super__.constructor.apply(this,arguments)}return t(e,f),e}(),i=Y.DepArray=function(n){function e(n,t){this.f=n,e.__super__.constructor.call(this,[],t),Y.autoSub(x(function(n){return function(){return Array.from(n.f())}}(this)).onSet,function(n){return function(t){var e;return t[0],e=t[1],n._update(e)}}(this))}return t(e,p),e}(),Y.IndexedArray=function(n){function e(n){this._cells=n}return t(e,i),e.prototype.map=function(n){var t;return t=new h,Y.autoSub(this._cells.onChange,function(e){var r,u,i;return u=e[0],i=e[1],r=e[2],t.realSplice(u,i.length,r.map(n))}),t},e}(),Y.concat=function(){var t,e,r,u,i;return u=1<=arguments.length?n.call(arguments,0):[],i=new h,t=u.map(function(n){return nn.cast(n,"array")}),e=function(){var n,t,e;for(e=[],n=0,t=u.length;n<t;n++)r=u[n],e.push(0);return e}(),t.forEach(function(n,t){return Y.autoSub(n.onChange,function(n){var r,u,o,s;return u=n[0],o=n[1],r=n[2],s=un(e.slice(0,t)),e[t]+=r.length-o.length,i.realSplice(s+u,o.length,r)})}),i},G=function(n){return n instanceof Map?n:e.isArray(n)?new Map(n):new Map(e.pairs(n))},m=Y.ObsMap=function(n){function r(n){this._base=null!=n?n:new Map,r.__super__.constructor.call(this),this._base=G(this._base),this.onAdd=this._mkEv(function(n){return function(){return new Map(n._base)}}(this)),this.onRemove=this._mkEv(function(){return new Map}),this.onChange=this._mkEv(function(){return new Map})}return t(r,d),r.prototype.get=function(n){return this.subAll(function(t){return t.has(n)}),this._base.get(n)},r.prototype.has=function(n){return X.sub(this.onAdd,function(t){return t.has(n)}),X.sub(this.onRemove,function(t){return t.has(n)}),this._base.has(n)},r.prototype.all=function(){return this.subAll(),new Map(this._base)},r.prototype.readonly=function(){return new s(function(n){return function(){return n.all()}}(this))},r.prototype.size=function(){return X.sub(this.onRemove),X.sub(this.onAdd),this._base.size},r.prototype.realPut=function(n,t){var e;return this._base.has(n)?((e=this._base.get(n))!==t&&(this._base.set(n,t),this.onChange.pub(new Map([[n,[e,t]]]))),e):(this._base.set(n,t),void this.onAdd.pub(new Map([[n,t]])))},r.prototype.realRemove=function(n){var t;return t=T(this._base,n),this.onRemove.pub(new Map([[n,t]])),t},r.prototype._update=function(n){var t,r,u,i,o;return u=G(n),o=new Map(this._base),i=function(n){return function(){return e.chain(Array.from(n._base.keys())).difference(Array.from(u.keys())).map(function(t){return[t,T(n._base,t)]}).value()}}(this)(),t=function(n){return function(){return e.chain(Array.from(u.keys())).difference(Array.from(n._base.keys())).map(function(t){var e;return e=u.get(t),n._base.set(t,e),[t,e]}).value()}}(this)(),r=function(n){return function(){return e.chain(Array.from(u)).filter(function(t){var e,r;return e=t[0],r=t[1],n._base.has(e)&&n._base.get(e)!==r}).map(function(t){var e,r,u;return e=t[0],u=t[1],r=n._base.get(e),n._base.set(e,u),[e,[r,u]]}).value()}}(this)(),Y.transaction(function(n){return function(){if(i.length&&n.onRemove.pub(new Map(i)),t.length&&n.onAdd.pub(new Map(t)),r.length)return n.onChange.pub(new Map(r))}}(this)),o},r}(),S=Y.SrcMap=function(n){function e(){return e.__super__.constructor.apply(this,arguments)}return t(e,m),e.prototype.put=function(n,t){return X.mutating(function(e){return function(){return e.realPut(n,t)}}(this))},e.prototype.set=function(n,t){return this.put(n,t)},e.prototype.delete=function(n){return X.mutating(function(t){return function(){var e;return e=void 0,t._base.has(n)&&(e=t.realRemove(n),t.onRemove.pub(new Map([[n,e]]))),e}}(this))},e.prototype.remove=function(n){return this.delete(n)},e.prototype.clear=function(){return X.mutating(function(n){return function(){var t;return t=new Map(n._base),n._base.clear(),t.size&&n.onRemove.pub(t),t}}(this))},e.prototype.update=function(n){return X.mutating(function(t){return function(){return t._update(n)}}(this))},e}(),s=Y.DepMap=function(n){function e(n){var t;this.f=n,e.__super__.constructor.call(this),t=x(this.f),Y.autoSub(t.onSet,function(n){return function(t){var e;return t[0],e=t[1],n._update(e)}}(this))}return t(e,m),e}(),V=function(n){return n instanceof Set?n:new Set(n)},A=function(n){return n instanceof Set||n instanceof y&&(n=n.all()),n instanceof p&&(n=n.all()),n instanceof g&&(n=n.get()),new Set(n)},y=Y.ObsSet=function(n){function e(n){this._base=null!=n?n:new Set,e.__super__.constructor.call(this),this._base=V(this._base),this.onChange=this._mkEv(function(n){return function(){return[n._base,new Set]}}(this))}return t(e,d),e.prototype.has=function(n){return this.subAll(function(t){var e,r;return e=t[0],r=t[1],e.has(n)||r.has(n)}),this._base.has(n)},e.prototype.all=function(){return this.subAll(),new Set(this._base)},e.prototype.readonly=function(){return new c(function(n){return function(){return n.all()}}(this))},e.prototype.values=function(){return this.all()},e.prototype.entries=function(){return this.all()},e.prototype.size=function(){return this.subAll(function(n){var t,e;return t=n[0],e=n[1],t.size!==e.size}),this._base.size},e.prototype.union=function(n){return new c(function(t){return function(){return hn(t.all(),A(n))}}(this))},e.prototype.intersection=function(n){return new c(function(t){return function(){return B(t.all(),A(n))}}(this))},e.prototype.difference=function(n){return new c(function(t){return function(){return j(t.all(),A(n))}}(this))},e.prototype.symmetricDifference=function(n){return new c(function(t){return function(){var e;return e=t.all(),n=A(n),new Set(Array.from(hn(e,n)).filter(function(t){return!e.has(t)||!n.has(t)}))}}(this))},e.prototype._update=function(n){return Y.transaction(function(t){return function(){var e,r,u,i;return u=new Set(t._base),r=V(n),e=new Set,i=new Set,u.forEach(function(n){if(!r.has(n))return i.add(n)}),r.forEach(function(n){if(!u.has(n))return e.add(n)}),u.forEach(function(n){return t._base.delete(n)}),r.forEach(function(n){return t._base.add(n)}),t.onChange.pub([e,i]),u}}(this))},e}(),C=Y.SrcSet=function(n){function e(){return e.__super__.constructor.apply(this,arguments)}return t(e,y),e.prototype.add=function(n){return X.mutating(function(t){return function(){return t._base.has(n)||(t._base.add(n),t.onChange.pub([new Set([n]),new Set])),n}}(this))},e.prototype.put=function(n){return this.add(n)},e.prototype.delete=function(n){return X.mutating(function(t){return function(){return t._base.has(n)&&(t._base.delete(n),t.onChange.pub([new Set,new Set([n])])),n}}(this))},e.prototype.remove=function(n){return this.delete(n)},e.prototype.clear=function(){return X.mutating(function(n){return function(){var t;return t=new Set(n._base),n._base.size&&(n._base.clear(),n.onChange.pub([new Set,t])),t}}(this))},e.prototype.update=function(n){return X.mutating(function(t){return function(){return t._update(n)}}(this))},e}(),c=Y.DepSet=function(n){function e(n){var t;this.f=n,e.__super__.constructor.call(this),t=x(this.f),Y.autoSub(t.onSet,function(n){return function(t){var e;return t[0],e=t[1],n._update(e)}}(this))}return t(e,y),e}(),Y.cellToSet=function(n){return new Y.DepSet(function(){return n.get()})},Y.liftSpec=function(n){var t,r,u;return e.object(function(){var i,o,s,a;for(a=[],i=0,o=(s=Object.getOwnPropertyNames(n)).length;i<o;i++)t=s[i],null!=(u=n[t])&&[Y.ObsMap,Y.ObsCell,Y.ObsArray,Y.ObsSet].some(function(n){return u instanceof n})||(r=e.isFunction(u)?null:e.isArray(u)?"array":u instanceof Set?"set":u instanceof Map?"map":"cell",a.push([t,{type:r,val:u}]));return a}())},Y.lift=function(n,t){return null==t&&(t=Y.liftSpec(n)),e.mapObject(t,function(t,e){var r;return r=t.type,!(n[e]instanceof d)&&r in Y.types?Y[r](n[e]):n[e]})},Y.unlift=function(n){return e.mapObject(n,function(n){return n instanceof Y.ObsBase?n.all():n})},Y.reactify=function(t,r){var u,i,o,s;return e.isArray(t)?(u=Y.array(e.clone(t)),Object.defineProperties(t,e.object(function(){var r,o,s,a;for(a=[],r=0,o=(s=e.functions(u)).length;r<o;r++)"length"!==(i=s[r])&&a.push(function(e){var r,i,o;return r=t[e],i=function(){var i,o,s;return i=1<=arguments.length?n.call(arguments,0):[],null!=r&&(s=r.call.apply(r,[t].concat(n.call(i)))),(o=u[e]).call.apply(o,[u].concat(n.call(i))),s},o={configurable:!0,enumerable:!1,value:i,writable:!0},[e,o]}(i));return a}())),t):Object.defineProperties(t,e.object(function(){var t;t=[];for(o in r)s=r[o],t.push(function(t,e){var r,u,i,o,s;switch(r=null,e.type){case"cell":u=Y.cell(null!=(i=e.val)?i:null),r={configurable:!0,enumerable:!0,get:function(){return u.get()},set:function(n){return u.set(n)}};break;case"array":s=Y.reactify(null!=(o=e.val)?o:[]),r={configurable:!0,enumerable:!0,get:function(){return s.all(),s},set:function(t){return s.splice.apply(s,[0,s.length].concat(n.call(t))),s}};break;default:throw new Error("Unknown observable type: "+type)}return[t,r]}(o,s));return t}()))},Y.autoReactify=function(n){var t,r,u;return Y.reactify(n,e.object(function(){var i,o,s,a;for(a=[],i=0,o=(s=Object.getOwnPropertyNames(n)).length;i<o;i++)t=s[i],(u=n[t])instanceof m||u instanceof g||u instanceof p||(r=e.isFunction(u)?null:e.isArray(u)?"array":"cell",a.push([t,{type:r,val:u}]));return a}()))},Y.cell=function(n){return new w(n)},Y.cell.from=function(n){return n instanceof g?n:x(n instanceof d?function(){return n.all()}:function(){return n})},Y.array=function(n,t){return new _((null!=n?n:[]).map(Y.cell),t)},Y.array.from=function(n,t){var r;if(n instanceof Y.ObsArray)return n;if(e.isArray(n))r=function(){return n};else{if(!(n instanceof d))throw new Error("Cannot cast "+n.constructor.name+" to array!");r=function(){return n.all()}}return new i(r,t)},Y.map=function(n){return new S(n)},Y.map.from=function(n){return n instanceof Y.ObsMap?n:new s(n instanceof d?function(){return n.get()}:function(){return n})},Y.set=function(n){return new C(n)},Y.set.from=function(n){return n instanceof Y.ObsSet?n:new c(n instanceof Y.ObsBase?function(){return n.all()}:function(){return n})},Y.cast=function(n,t){var r,u,i;if(null==t&&(t="cell"),t===g||t===p||t===m||t===y){switch(u=null,t){case g:u="cell";break;case p:u="array";break;case m:u="map";break;case y:u="set"}t=u}return e.isString(t)?t in Y.types?Y[t].from(n):n:(r=n,i=t,e.mapObject(r,function(n,t){return i[t]?Y.cast(n,i[t]):n}))},Y.flatten=function(n){return new i(function(){return e.chain(z([n])).flatten().filter(function(n){return null!=n}).value()})},Q=function(n){return(n instanceof g||n instanceof p||e.isArray(n))&&(n=Y.flatten(n)),n},z=function(n){return n instanceof p?z(n.all()):n instanceof y?z(Array.from(n.values())):n instanceof g?z(n.get()):n instanceof Set?z(Array.from(n)):e.isArray(n)?n.map(function(n){return z(n)}):n},function(n){return e.flatten(n),Y.cellToArray(x(function(){return e.flatten(n)}))},Y.cellToArray=function(n,t){return new i(function(){return n.get()},t)},Y.cellToMap=function(n){return new Y.DepMap(function(){return n.get()})},Y.cellToSet=function(n){return new Y.DepSet(function(){return n.get()})},Y.basicDiff=function(n){return null==n&&(n=Y.smartUidify),function(t,e){var r,u,i,o,s,a,c;for(o=U(function(){var e,u,i;for(i=[],r=e=0,u=t.length;e<u;r=++e)c=t[r],i.push([n(c),r]);return i}()),a=[],u=0,i=e.length;u<i;u++)c=e[u],a.push(null!=(s=o[n(c)])?s:-1);return a}},Y.uidify=function(n){var t;return null!=(t=n.__rxUid)?t:Object.defineProperty(n,"__rxUid",{enumerable:!1,value:q()}).__rxUid},Y.smartUidify=function(n){return e.isObject(n)?Y.uidify(n):JSON.stringify(n)},F=function(n,t,r){var u,i,o,s,a,c;if(!t.length)return null;if(s=function(){var n,t,e;for(e=[],n=0,t=r.length;n<t;n++)(i=r[n])>=0&&e.push(i);return e}(),e.some(function(){var n,t,e;for(e=[],i=n=0,t=s.length-1;0<=t?n<t:n>t;i=0<=t?++n:--n)e.push(s[i+1]-s[i]<=0);return e}()))return null;for(c=[],o=-1,i=0;i<r.length;){for(;i<r.length&&r[i]===o+1;)o+=1,i+=1;for(a={index:i,count:0,additions:[]};i<r.length&&-1===r[i];)a.additions.push(t[i]),i+=1;u=i===r.length?n:r[i],a.count=u-(o+1),(a.count>0||a.additions.length>0)&&c.push([a.index,a.count,a.additions]),o=u,i+=1}return c},Y.transaction=function(n){return O.transaction(n)},null!=u){u.fn.rx=function(n){var t,e,r,u;return null==(r=this.data("rx-map"))&&this.data("rx-map",r=U()),n in r?r[n]:r[n]=function(){switch(n){case"focused":return e=Y.cell(this.is(":focus")),this.focus(function(){return e.set(!0)}),this.blur(function(){return e.set(!1)}),e;case"val":return u=Y.cell(this.val()),this.change(function(n){return function(){return u.set(n.val())}}(this)),this.on("input",function(n){return function(){return u.set(n.val())}}(this)),u;case"checked":return t=Y.cell(this.is(":checked")),this.change(function(n){return function(){return t.set(n.is(":checked"))}}(this)),t;default:throw new Error("Unknown reactive property type")}}.call(this)},(nn={}).events={},nn.events.enabled=!1,nn.events.onElementChildrenChanged=new l,nn.events.onElementAttrsChanged=new l,b=nn.RawHtml=function(){return function(n){this.html=n}}(),D=["blur","change","click","dblclick","error","focus","focusin","focusout","hover","keydown","keypress","keyup","load","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","ready","resize","scroll","select","submit","toggle","unload"],on=["click"],rn=nn.specialAttrs={init:function(n,t){return t.call(n)}},N=function(n){return rn[n]=function(t,e){return t instanceof SVGElement&&r.call(on,n)>=0?t.addEventListener(n,e):t[n](function(n){return e.call(t,n)})}};for(I=0,W=D.length;I<W;I++)N(D[I]);K=["async","autofocus","checked","location","multiple","readOnly","selected","selectedIndex","tagName","nodeName","nodeType","ownerDocument","defaultChecked","defaultSelected"],Z=e.object(function(){var n,t,e;for(e=[],n=0,t=K.length;n<t;n++)J=K[n],e.push([J,null]);return e}()),en=function(n,t,e){return n instanceof SVGElement?n.setAttribute(t,e):"value"===t?n.val(e):t in Z?n.prop(t,e):n.attr(t,e)},tn=function(n,t,r,u){return null==u&&(u=e.identity),r instanceof g?Y.autoSub(r.onSet,function(e){var r;if(e[0],r=e[1],en(n,t,u(r)),nn.events.enabled)return nn.events.onElementAttrsChanged.pub({$element:n,attr:t})}):en(n,t,u(r))},H=function(n,t){return null==n&&null==t?[{},null]:n instanceof Object&&null!=t?[n,t]:null==t&&e.isString(n)||e.isNumber(n)||n instanceof Element||n instanceof SVGElement||n instanceof b||n instanceof u||e.isArray(n)||n instanceof g||n instanceof p||n instanceof y?[{},n]:[n,null]},fn=function(n){var t,r,i,o,s;for(s=[],r=0,i=n.length;r<i;r++)if(null!=(t=n[r]))if(e.isString(t)||e.isNumber(t))s.push(document.createTextNode(t));else if(t instanceof Element||t instanceof SVGElement)s.push(t);else if(t instanceof b){if(1!==(o=u(t.html)).length)throw new Error("RawHtml must wrap a single element");s.push(o[0])}else{if(!(t instanceof u))throw new Error("Unknown element type in array: "+t.constructor.name+" (must be string, number, Element, RawHtml, or jQuery objects)");if(1!==t.length)throw new Error("jQuery object must wrap a single element");s.push(t[0])}else s.push(void 0);return s},pn=function(n,t){var r;if(n.html&&n.html(""),null!=t){if(e.isArray(t))return r=fn(t),n.append(r),r;if(e.isString(t)||e.isNumber(t)||t instanceof Element||t instanceof SVGElement||t instanceof b||t instanceof u)return pn(n,[t]);throw new Error("Unknown type for element contents: "+t.constructor.name+" (accepted types: string, number, Element, RawHtml, jQuery object of single element, or array of the aforementioned)")}},nn.mktag=function(n){return function(t,r){var i,o,s,a,c,l,f,h;i=(l=H(t,r))[0],o=l[1],o=Q(o),s=u("<"+n+"/>"),f=e.omit(i,e.keys(rn));for(c in f)h=f[c],tn(s,c,h);null!=o&&(o instanceof p?Y.autoSub(o.indexed().onChangeCells,function(n){var t,e,r,u,i,o,a,c,l,f;for(u=n[0],c=n[1],t=n[2],s.contents().slice(u,u+c.length).remove(),f=fn(t.map(function(n){var t;return t=n[0],n[1],Y.snap(function(){return t.get()})})),u===s.contents().length?s.append(f):s.contents().eq(u).before(f),nn.events.enabled&&(c.length||f.length)&&nn.events.onElementChildrenChanged.pub({$element:s,type:"childrenUpdated",added:f,removed:fn(c.map(function(n){return Y.snap(function(){return n.get()})}))}),l=[],i=0,o=t.length;i<o;i++)e=(a=t[i])[0],r=a[1],l.push(function(n,t){return Y.autoSub(n.onSet,Y.skipFirst(function(n){var e,r;if(n[0],r=n[1],e=Y.snap(function(){return t.get()}),f=fn([r]),s.contents().eq(e).replaceWith(f),nn.events.enabled)return nn.events.onElementChildrenChanged.pub({$element:s,type:"childrenUpdated",updated:f})}))}(e,r));return l}):pn(s,o));for(a in i)a in rn&&rn[a](s,i[a],i,o);return s}},ln=["html","head","title","base","link","meta","style","script","noscript","body","body","section","nav","article","aside","h1","h2","h3","h4","h5","h6","h1","h6","header","footer","address","main","main","p","hr","pre","blockquote","ol","ul","li","dl","dt","dd","dd","figure","figcaption","div","a","em","strong","small","s","cite","q","dfn","abbr","data","time","code","var","samp","kbd","sub","sup","i","b","u","mark","ruby","rt","rp","bdi","bdo","span","br","wbr","ins","del","img","iframe","embed","object","param","object","video","audio","source","video","audio","track","video","audio","canvas","map","area","area","map","svg","math","table","caption","colgroup","col","tbody","thead","tfoot","tr","td","th","form","fieldset","legend","fieldset","label","input","button","select","datalist","optgroup","option","select","datalist","textarea","keygen","output","progress","meter","details","summary","details","menuitem","menu"],sn=["a","altglyph","altglyphdef","altglyphitem","animate","animatecolor","animatemotion","animatetransform","circle","clippath","color-profile","cursor","defs","desc","ellipse","feblend","fecolormatrix","fecomponenttransfer","fecomposite","feconvolvematrix","fediffuselighting","fedisplacementmap","fedistantlight","feflood","fefunca","fefuncb","fefuncg","fefuncr","fegaussianblur","feimage","femerge","femergenode","femorphology","feoffset","fepointlight","fespecularlighting","fespotlight","fetile","feturbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialgradient","rect","script","set","stop","style","svg","switch","symbol","text","textpath","title","tref","tspan","use","view","vkern"],dn=function(n,t){for(var r,u,i,o,s;n.firstChild;)n.removeChild(n.firstChild);if(e.isArray(t)){for(o=[],r=0,u=(s=fn(t)).length;r<u;r++)i=s[r],o.push(n.appendChild(i));return o}if(e.isString(t)||t instanceof SVGElement)return dn(n,[t]);throw console.error("updateSVGContents",n,t),"Must wrap contents "+t+" as array or string"},nn.svg_mktag=function(n){return function(t,r){var u,i,o,s,a,c,l,f;u=(c=H(t,r))[0],i=c[1],o=document.createElementNS("http://www.w3.org/2000/svg",n),l=e.omit(u,e.keys(rn));for(a in l)f=l[a],tn(o,a,f);null!=i&&(i instanceof p?i.onChange.sub(function(n){var t,e,r,u,i,s,a,c,l,f,h,p,d;for(e=n[0],f=n[1],t=n[2],r=0,l=f.length;0<=l?r<l:r>l;0<=l?++r:--r)o.removeChild(o.childNodes[e]);if(d=fn(t),e===o.childNodes.length){for(h=[],s=0,u=d.length;s<u;s++)a=d[s],h.push(o.appendChild(a));return h}for(p=[],c=0,i=d.length;c<i;c++)a=d[c],p.push(o.childNodes[e].insertBefore(a));return p}):i instanceof g?i.onSet.sub(function(n){var t;return n[0],t=n[1],dn(o,t)}):dn(o,i));for(s in u)s in rn&&rn[s](o,u[s],u,i);return o}},nn.tags=e.object(function(){var n,t,e;for(e=[],n=0,t=ln.length;n<t;n++)cn=ln[n],e.push([cn,nn.mktag(cn)]);return e}()),R=nn.tags.input,k=function(n,t){return R(e.extend({type:n},t))},R.color=function(n){return k("color",n)},R.date=function(n){return k("date",n)},R.datetime=function(n){return k("datetime",n)},R.datetimeLocal=function(n){return k("datetime-local",n)},R.email=function(n){return k("email",n)},R.file=function(n){return k("file",n)},R.hidden=function(n){return k("hidden",n)},R.image=function(n){return k("image",n)},R.month=function(n){return k("month",n)},R.number=function(n){return k("number",n)},R.password=function(n){return k("password",n)},R.range=function(n){return k("range",n)},R.reset=function(n){return k("reset",n)},R.search=function(n){return k("search",n)},R.submit=function(n){return k("submit",n)},R.tel=function(n){return k("tel",n)},R.text=function(n){return k("text",n)},R.time=function(n){return k("time",n)},R.url=function(n){return k("url",n)},R.week=function(n){return k("week",n)},an=function(t){return t._oldProp=t.prop,t.prop=function(){var e,r;return e=1<=arguments.length?n.call(arguments,0):[],r=t._oldProp.apply(t,e),e.length>1&&"checked"===e[0]&&t.rx("checked").set(t.prop("checked")),r},t},R.checkbox=function(n){return an(R(e.extend({type:"checkbox"},n)))},R.radio=function(n){return an(R(e.extend({type:"radio"},n)))},nn.svg_tags=e.object(function(){var n,t,e;for(e=[],n=0,t=sn.length;n<t;n++)cn=sn[n],e.push([cn,nn.svg_mktag(cn)]);return e}()),nn.rawHtml=function(n){return new b(n)},nn.specialChar=function(n,t){return null==t&&(t="span"),nn.rawHtml("<"+t+">&"+n+";</"+t+">")},nn.unicodeChar=function(n,t){return null==t&&(t="span"),nn.rawHtml("<"+t+">\\u"+n+";</"+t+">")},nn.importTags=function(n){return function(t){return e(null!=t?t:n).extend(nn.tags)}}(this),nn.cast=function(n,t){return null==t&&(t="cell"),console.warn("Warning: rx.rxt.cast is deprecated. Use rx.cast instead."),Y.cast(n,t)},nn.trim=u.trim,nn.dasherize=function(n){return nn.trim(n).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},nn.cssify=function(n){var t,r;return console.warn("cssify is deprecated; set the `style` property directly to a JSON object."),function(){var u;u=[];for(t in n)null!=(r=n[t])&&u.push(nn.dasherize(t)+": "+(e.isNumber(r)?r+"px":r)+";");return u}().join(" ")},rn.style=function(n,t){var r;return r=t instanceof g,Y.autoSub(Y.cast(t).onSet,function(t){var u;if(t[0],null==(u=t[1])||e.isString(u)?en(n,"style",u):n.removeAttr("style").css(u),r&&nn.events.enabled)return nn.events.onElementAttrsChanged.pub({$element:n,attr:"style"})})},nn.smushClasses=function(n){return e(n).chain().flatten().compact().value().join(" ").replace(/\s+/," ").trim()},rn.class=function(n,t){return tn(n,"class",t,function(n){return e.isString(n)?n:nn.smushClasses(n)})}}return Y.rxt=nn,Y})}).call(this);